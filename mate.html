<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>M√°t√© bankja</title>
    <link rel="icon" href="logo.png" type="image/png" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #7097E6;
      text-align: center;
      padding: 40px;
    }
    .card {
      background: white;
      display: inline-block;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      max-width: 400px;
    }
    input, select {
      padding: 10px;
      margin: 10px;
      width: 80%;
    }
    .button {
      padding: 10px 20px;
      background-color: #7097E6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .button:hover {
      background-color: #357ae8;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    /* Logo Styling */
    .logo {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 150px; /* Increased size */
      height: 150px; /* Increased size */
    }
    /* Kupon lista gomb */
    .coupon-btn {
      margin-left: 10px;
      background-color: #4CAF50;
      padding: 5px 10px;
      font-size: 0.9em;
    }
    .coupon-btn:hover {
      background-color: #388E3C;
    }
  </style>
</head>
<body>
  <img src="logo.png" alt="Logo" class="logo">
  <div class="card">
    <h1>√údv√∂zl√ºnk, M√°t√©!</h1>
    <p>Egyenleged: <strong id="balance">0 Ft</strong></p>

    <h3>Utal√°s</h3>
    <select id="receiver">
      <option value="" disabled selected>V√°lassz c√≠mzettet</option>
      <option value="Dani">Dani</option>
      <option value="Barni">Barni</option>
      <option value="√Åd√°m">√Åd√°m</option>
      <option value="Kamilla">Kamilla</option>
      <option value="Mama">Mama</option>
    </select><br />
    <input type="number" id="amount" placeholder="√ñsszeg Ft-ban" /><br />
    <button class="button" onclick="transfer()">Utal√°s</button>

    <p id="message"></p>

    <hr />

    <!-- Kupon r√©sz -->
    <h3>Kupon bev√°lt√°sa</h3>
    <input type="text" id="couponCode" placeholder="√çrd be a kuponk√≥dot" />
    <button class="button" onclick="activateCoupon()">Bev√°lt√°s</button>
    <p id="couponMessage"></p>

    <h3>Akt√≠v kuponok:</h3>
    <ul id="activeCouponsList" style="list-style:none; padding-left:0;"></ul>

    <hr />

    <br /><br />
<button class="button" onclick="location.href='login.html'">Kijelentkez√©s</button>
    <button class="button" onclick="resetBalances()">üíæ Egyenlegek vissza√°ll√≠t√°sa</button>
  </div>

  <script>
    const currentUser = "M√°t√©";

    const defaultBalances = {
      "M√°t√©": 5000,
      "Dani": 5000,
      "Barni": 5000,
      "√Åd√°m": 5000,
      "Kamilla": 5000,
      "Mama": 5000
    };

    // Kupon k√≥dok √©s le√≠r√°sok
    const coupons = {
      "1000KEKSZ": "-1000 keksz",
      "FILMV": "Filmv√°laszt√°s",
      "JATEK": "Te v√°lasztod a j√°t√©kot",
      "HOLALSZ": "Hol alszol",
      "KIVELALSZ": "Kivel alszol",
      "EBED": "Eb√©dv√°laszt√°s",
      "JATSZOTER": "J√°tsz√≥t√©r"
    };

    // --- EGYENLEGEK kezel√©se ---

    function loadBalances() {
      let balances = localStorage.getItem("balances");
      if (!balances) {
        localStorage.setItem("balances", JSON.stringify(defaultBalances));
        return {...defaultBalances};
      } else {
        return JSON.parse(balances);
      }
    }

    function saveBalances(balances) {
      localStorage.setItem("balances", JSON.stringify(balances));
    }

    function updateBalanceDisplay() {
      const balances = loadBalances();
      document.getElementById("balance").textContent = balances[currentUser].toLocaleString() + " Keksz";
    }

    function transfer() {
      const receiver = document.getElementById("receiver").value;
      const amountInput = document.getElementById("amount");
      const amount = parseInt(amountInput.value);
      const message = document.getElementById("message");
      const balances = loadBalances();

      message.textContent = "";
      message.className = "";

      if (!receiver || isNaN(amount) || amount <= 0) {
        message.textContent = "Adj meg √©rv√©nyes c√≠mzettet √©s √∂sszeget.";
        message.className = "error";
        return;
      }
      if (receiver === currentUser) {
        message.textContent = "Nem utalhatsz magadnak!";
        message.className = "error";
        return;
      }
      if (balances[currentUser] < amount) {
        message.textContent = "Nincs el√©g egyenleg az utal√°shoz!";
        message.className = "error";
        return;
      }

      balances[currentUser] -= amount;
      balances[receiver] += amount;

      saveBalances(balances);
      updateBalanceDisplay();

      message.textContent = `Sikeresen utalt√°l ${amount.toLocaleString()} Ft-ot ${receiver} r√©sz√©re.`;
      message.className = "success";

      amountInput.value = "";
      document.getElementById("receiver").selectedIndex = 0;
    }

    function resetBalances() {
      localStorage.setItem("balances", JSON.stringify(defaultBalances));
      updateBalanceDisplay();
      const message = document.getElementById("message");
      message.textContent = "Egyenlegek vissza√°ll√≠tva az alap√©rt√©kekre.";
      message.className = "success";
    }

    // --- KUPONOK kezel√©se ---

    // Kuponokat t√°roljuk localStorage-ban az "activeCoupons" kulcs alatt, objektum:
    // { "Felhaszn√°l√≥": [kuponk√≥dok t√∂mbje] }

    function loadActiveCoupons() {
      let data = localStorage.getItem("activeCoupons");
      if (!data) {
        const obj = {};
        localStorage.setItem("activeCoupons", JSON.stringify(obj));
        return obj;
      } else {
        return JSON.parse(data);
      }
    }

    function saveActiveCoupons(obj) {
      localStorage.setItem("activeCoupons", JSON.stringify(obj));
    }

    function showActiveCoupons() {
      const activeCoupons = loadActiveCoupons();
      if (!activeCoupons[currentUser]) activeCoupons[currentUser] = [];

      const listEl = document.getElementById("activeCouponsList");
      listEl.innerHTML = "";

      if (activeCoupons[currentUser].length === 0) {
        listEl.innerHTML = "<li>Nincsenek akt√≠v kuponjaid.</li>";
        return;
      }

      activeCoupons[currentUser].forEach(code => {
        const li = document.createElement("li");
        li.textContent = coupons[code] || code;

        // Felhaszn√°l√°s gomb
        const btn = document.createElement("button");
        btn.textContent = "Felhaszn√°lom";
        btn.className = "coupon-btn";
        btn.onclick = () => {
          useCoupon(code);
        };

        li.appendChild(btn);
        listEl.appendChild(li);
      });
    }

    function activateCoupon() {
      const input = document.getElementById("couponCode");
      const code = input.value.trim().toUpperCase();
      const msg = document.getElementById("couponMessage");

      msg.textContent = "";
      msg.className = "";

      if (!code) {
        msg.textContent = "K√©rlek, adj meg egy kuponk√≥dot!";
        msg.className = "error";
        return;
      }
      if (!(code in coupons)) {
        msg.textContent = "√ârv√©nytelen kuponk√≥d!";
        msg.className = "error";
        return;
      }

      const activeCoupons = loadActiveCoupons();
      if (!activeCoupons[currentUser]) activeCoupons[currentUser] = [];

      if (activeCoupons[currentUser].includes(code)) {
        msg.textContent = "Ezt a kupont m√°r aktiv√°ltad!";
        msg.className = "error";
        return;
      }

      activeCoupons[currentUser].push(code);
      saveActiveCoupons(activeCoupons);

      msg.textContent = `Sikeresen aktiv√°ltad a kuponodat: ${coupons[code]}`;
      msg.className = "success";

      input.value = "";
      showActiveCoupons();
    }

    function useCoupon(code) {
      const activeCoupons = loadActiveCoupons();
      if (!activeCoupons[currentUser]) activeCoupons[currentUser] = [];

      // T√∂r√∂lj√ºk a kupon k√≥dot az akt√≠vak k√∂z√ºl (felhaszn√°lva)
      activeCoupons[currentUser] = activeCoupons[currentUser].filter(c => c !== code);
      saveActiveCoupons(activeCoupons);

      // Opci√≥: ha a kupon haszn√°lata valamilyen hat√°ssal van az egyenlegre, itt lehet megval√≥s√≠tani
      // Pl. -1000 keksz kupon eset√©n levonjuk az egyenlegb≈ël 1000-et
      if (code === "1000KEKSZ") {
        const balances = loadBalances();
        balances[currentUser] = Math.max(0, balances[currentUser] - 1000);
        saveBalances(balances);
        updateBalanceDisplay();
      }

      // √úzenet megjelen√≠t√©se
      const msg = document.getElementById("couponMessage");
      msg.textContent = `Felhaszn√°ltad a kuponodat: ${coupons[code]}`;
      msg.className = "success";

      showActiveCoupons();
    }

    // Inicializ√°l√°s
    updateBalanceDisplay();
    showActiveCoupons();
  </script>
</body>
</html>